<!-- templates/catalog/partials/component_grid.html -->
 
<div class="grid">
    
    {% for component in components %}
    <div class="card">
                <a href="{% url 'catalog:component_detail' component.id %}" style="text-decoration: none; color: inherit;"></a>
        {% if component.image %}
             <img src="{{ component.image }}" alt="{{ component.name }}" style="max-height: 150px; object-fit: contain; margin-bottom: 1em;">
        {% else %}
            <div style="height: 150px; background-color: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #ccc; margin-bottom: 1em;">No Image</div>
        {% endif %}
             <a href="{% url 'catalog:component_detail' component.id %}" class="card-link">
            <h4>{{ component.name }}</h4>
        
        </a>
       
        <div class="card-price">à§³{{ component.price|floatformat:2 }}</div>
        <!-- templates/catalog/partials/component_grid.html -->

        <div class="card-actions">
            <!-- This is the container for our button. We give it a unique ID
                 so HTMX can easily replace just this button after the action. -->
            <div id="wishlist-btn-{{ component.id }}">

                <!-- Logic to show different buttons based on login status -->
                {% if user.is_authenticated %}
                    
                    <!-- LOGGED-IN: Show the functional HTMX button -->
                    <button 
                        class="btn btn-primary"
                        style="background-color: #007bff; color:#f0f0f0"
                        hx-post="{% url 'builds:add_to_wishlist' %}"
                        hx-vals='{"component_id": "{{ component.id }}"}'
                        hx-target="#wishlist-btn-{{ component.id }}"
                        hx-swap="innerHTML"
                        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
                        Add to Wishlist
                    </button>

                {% else %}

                    <!-- LOGGED-OUT: Show a link to the login page -->
                    <a href="{% url 'users:login' %}" class="btn btn-primary" style="background-color: #007bff; color:#f0f0f0">
                        Add to Wishlist
                    </a>

                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <p style="grid-column: 1 / -1; text-align: center; color: #6c757d;">
        No components found matching your criteria.
    </p>
    {% endfor %}
</div>